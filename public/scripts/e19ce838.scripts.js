"use strict";var app=angular.module("twitVizualApp",["ngCookies","ngResource","ngSanitize","ngRoute"]);app.config(["$routeProvider","$locationProvider","$httpProvider",function(a,b,c){a.when("/",{templateUrl:"partials/main",controller:"MainController"}).when("/login",{templateUrl:"partials/login",controller:"LoginController"}).when("/signup",{templateUrl:"partials/signup",controller:"SignupController"}).when("/settings",{templateUrl:"partials/settings",controller:"SettingsController",authenticate:!0}).when("/about",{templateUrl:"partials/about"}).when("/metrics",{templateUrl:"partials/metrics",controller:"MetricsController"}).otherwise({redirectTo:"/"}),b.html5Mode(!0),c.interceptors.push(["$q","$location",function(a,b){return{responseError:function(c){return 401===c.status?(b.path("/login"),a.reject(c)):a.reject(c)}}}])}]).run(["$rootScope","$location","Auth",function(a,b,c){a.$on("$routeChangeStart",function(a,d){d.authenticate&&!c.isLoggedIn()&&b.path("/login")})}]),app.factory("d3Service",["$document","$q","$rootScope",function(a,b,c){function d(){c.$apply(function(){e.resolve(window.d3)})}var e=b.defer(),f=a[0].createElement("script");f.type="text/javascript",f.async=!0,f.src="http://d3js.org/d3.v3.min.js",f.onreadystatechange=function(){"complete"===this.readyState&&d()},f.onload=d;var g=a[0].getElementsByTagName("body")[0];return g.appendChild(f),{d3:function(){return e.promise}}}]),app.controller("MainController",["$scope","TweetService",function(a,b){b.getTweets().success(function(b){a.tweets=b}).error(function(a){console.log("error"),console.log(a)})}]),app.controller("NavbarController",["$scope","$location","Auth",function(a,b,c){a.menu=[{title:"Home",link:"/"}],a.logout=function(){c.logout().then(function(){b.path("/login")})},a.isActive=function(a){return a===b.path()}}]),app.controller("LoginController",["$scope","Auth","$location",function(a,b,c){a.user={},a.errors={},a.login=function(d){a.submitted=!0,d.$valid&&b.login({email:a.user.email,password:a.user.password}).then(function(){c.path("/")}).catch(function(b){b=b.data,a.errors.other=b.message})}}]),app.controller("SignupController",["$scope","Auth","$location",function(a,b,c){a.user={},a.errors={},a.register=function(d){a.submitted=!0,d.$valid&&b.createUser({name:a.user.name,email:a.user.email,password:a.user.password}).then(function(){c.path("/")}).catch(function(b){b=b.data,a.errors={},angular.forEach(b.errors,function(b,c){d[c].$setValidity("mongoose",!1),a.errors[c]=b.message})})}}]),app.controller("SettingsController",["$scope","User","Auth",function(a,b,c){a.errors={},a.changePassword=function(b){a.submitted=!0,b.$valid&&c.changePassword(a.user.oldPassword,a.user.newPassword).then(function(){a.message="Password successfully changed."}).catch(function(){b.password.$setValidity("mongoose",!1),a.errors.other="Incorrect password"})}}]),app.controller("MetricsController",["$scope","TweetService",function(a,b){var c=100;b.getTweets().success(function(b){a.tweets=b,a.d3Data=[{name:"AI",count:0},{name:"ArtificialIntelligence",count:0},{name:"ML",count:0},{name:"MachineLearning",count:0},{name:"VR",count:0},{name:"VirtualReality",count:0},{name:"AR",count:0},{name:"AugmentedReality",count:0},{name:"MixedReality",count:0}];for(var d=0;d<a.tweets.length&&!(d>=c);d++)-1!==a.tweets[d].text.toUpperCase().indexOf(a.d3Data[0].name)?a.d3Data[0].count++:-1!==a.tweets[d].text.toUpperCase().indexOf(a.d3Data[1].name)?a.d3Data[1].count++:-1!==a.tweets[d].text.toUpperCase().indexOf(a.d3Data[2].name)?a.d3Data[2].count++:-1!==a.tweets[d].text.toUpperCase().indexOf(a.d3Data[3].name)?a.d3Data[3].count++:-1!==a.tweets[d].text.toUpperCase().indexOf(a.d3Data[4].name)?a.d3Data[4].count++:-1!==a.tweets[d].text.toUpperCase().indexOf(a.d3Data[5].name)?a.d3Data[5].count++:-1!==a.tweets[d].text.toUpperCase().indexOf(a.d3Data[6].name)?a.d3Data[6].count++:-1!==a.tweets[d].text.toUpperCase().indexOf(a.d3Data[7].name)?a.d3Data[7].count++:-1!==a.tweets[d].text.toUpperCase().indexOf(a.d3Data[8].name)&&a.d3Data[8].count++})}]),app.factory("Auth",["$location","$rootScope","Session","User","$cookieStore",function(a,b,c,d,e){return b.currentUser=e.get("user")||null,e.remove("user"),{login:function(a,d){var e=d||angular.noop;return c.save({email:a.email,password:a.password},function(a){return b.currentUser=a,e()},function(a){return e(a)}).$promise},logout:function(a){var d=a||angular.noop;return c.delete(function(){return b.currentUser=null,d()},function(a){return d(a)}).$promise},createUser:function(a,c){var e=c||angular.noop;return d.save(a,function(a){return b.currentUser=a,e(a)},function(a){return e(a)}).$promise},changePassword:function(a,b,c){var e=c||angular.noop;return d.update({oldPassword:a,newPassword:b},function(a){return e(a)},function(a){return e(a)}).$promise},currentUser:function(){return d.get()},isLoggedIn:function(){var a=b.currentUser;return!!a}}}]),app.factory("Session",["$resource",function(a){return a("/api/session/")}]),app.factory("User",["$resource",function(a){return a("/api/users/:id",{id:"@id"},{update:{method:"PUT",params:{}},get:{method:"GET",params:{id:"me"}}})}]),app.directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.on("keydown",function(){return d.$setValidity("mongoose",!0)})}}}),app.directive("d3Bars",function(){return{restrict:"AE",scope:{data:"="},link:function(a,b,c){var d=parseInt(c.margin)||20,e=parseInt(c.barHeight)||20,f=parseInt(c.barPadding)||5,g=d3.select(b[0]).append("svg").style("width","100%").style("margin","5px");window.onresize=function(){a.$apply()},a.$watch(function(){return angular.element(window)[0].innerWidth},function(){a.render(a.data)}),a.render=function(c){if(g.selectAll("*").remove(),c){var h=d3.select(b[0]).node().offsetWidth-d,i=a.data.length*(e+f),j=d3.scale.category20(),k=d3.scale.linear().domain([0,d3.max(c,function(a){return a.count})]).range([0,h-120]);g.attr("height",i),g.selectAll("rect").data(c).enter().append("rect").attr("height",e).attr("width",140).attr("x",Math.round(d/2)+120).attr("y",function(a,b){return b*(e+f)+5}).attr("fill",function(a){return j(a.count)}).transition().duration(1e3).attr("width",function(a){return k(a.count)}),g.selectAll("text").data(c).enter().append("text").attr("fill","#000").attr("y",function(a,b){return b*(e+f)+20}).attr("x",0).text(function(a){return a.name+" ("+a.count+")"})}},a.$watch("data",function(b){return a.render(b)},!0)}}}),app.factory("TweetService",["$http",function(a){function b(){return a.get("/api/tweets").success(function(a){return console.log(a),a}).error(function(a){return console.log(a),a})}var c={getTweets:b};return c}]);